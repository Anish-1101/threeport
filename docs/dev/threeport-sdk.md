# Threeport SDK Development

Any source code files that have the `_gen.go` suffix were generated by the
Threeport SDK.

If that source code file has the following header comment, do not commit
changes made directly to that file.  Make changes to the SDK in order to change
those files.

```
// generated by 'threeport-sdk gen' - do not edit
```

If the source code file includes the following header, it may be modified in
place:

```
// generated by 'threeport-sdk gen' but will not be regenerated - intended for modification
```

## Changes to the Threeport SDK

The `internal/sdk` package contains the source code for the SDK.  It uses the
[dave/jennifer](https://github.com/dave/jennifer) library to generate Go source
code.

The `internal/sdk` package is organized to readily locate which files generate
which code in the threeport codebase.

The `threeport-sdk gen` command performs the bulk of the code generation.  The
SDK code for that command lives in `internal/sdk/gen`.  Sub-packages in that
`gen` package are organized according to the codebase being generated.  For
example, the SDK code for the `cmd/rest-api/main_gen.go` file is located in
`internal/sdk/gen/cmd/restapi/main.go`.

Following is the recommended routine for making SDK changes.  Examples given
here are for the case where changes need to be made to
`cmd/rest-api/main_gen.go`.

1. Make the intended change directly to the generated file.  Test that change
   for the intended outcome.

1. Make a backup of that file to preserve your in-place changes.

    ```
    cp cmd/rest-api/main_gen.go cmd/rest-api/main_gen.go.bak
    ```

1. Make changes to the SDK code that generates the code you want to change.  In
   this example, it would be `internal/sdk/gen/cmd/restapi/main.go`.

1. Build and install the `threeport-sdk` binary.

    ```
    mage installSdk
    ```

1. Run the SDK to generate the source code.

    ```
    threeport-sdk gen --config sdk-config.yaml
    ```

1. Compare your in-place changes in `cmd/rest-api/main_gen.go.bak` with the
   newly generated code in `cmd/rest-api/main_gen.go`.

1. Repeat the steps to update the SDK, install `threeport-sdk` and generate the
   code until the intended result is achieved.

1. Remove the backup file.

    ```
    rm cmd/rest-api/main_gen.go.bak
    ```

1. Open a PR with the SDK and resulting generated code changes together in the
same PR.

